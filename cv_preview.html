<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Preview</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <div class="first_section">
            <div class="profile_picture">
                <img id="preview_profile_picture" src="" alt="Profile Picture">
            </div>
            <div class="personal_information">
                <h1 id="preview_name" contenteditable="true">Your Name</h1>
                <h3>ðŸ“§ <a id="preview_email" href="mailto:" contenteditable="true">Your Email</a></h3>
                <div class="linkedin" style="display: none;">
                    <img src="/assets/linkedin.png" alt="LinkedIn Logo">
                    <h3><a id="preview_linkedin" href="#" target="_blank" contenteditable="true">LinkedIn</a></h3>
                </div>
                <div class="github" style="display: none;">
                    <img src="/assets/github.png" alt="GitHub Logo">
                    <h3><a id="preview_github" href="#" target="_blank" contenteditable="true">GitHub</a></h3>
                </div>
            </div>
        </div>
        <div class="second_section">
            <div class="work_experience">
                <h1>Work Experience</h1>
                <p id="preview_work_experience" contenteditable="true">Work Experience...</p>
            </div>
            <div class="education">
                <h1>Education</h1>
                <ul id="preview_education" contenteditable="true"></ul>
            </div>
            <div class="skills">
                <h1>Skills</h1>
                <ul id="preview_skills" contenteditable="true"></ul>
            </div>
        </div>
        <button id="save_changes">Save Changes</button>
    </div>

    <script>
        function getDisplayName(url) {
            try {
                const urlObj = new URL(url);
                const hostname = urlObj.hostname.replace('www.', '');
                if (hostname.includes('linkedin')) return 'LinkedIn';
                if (hostname.includes('github')) return 'GitHub';
            } catch (e) {
                console.error('Invalid URL:', url);
            }
            return url;
        }

        function populatePreview() {
            const profilePictureURL = localStorage.getItem('profile_picture');
            const name = localStorage.getItem('name');
            const email = localStorage.getItem('email');
            const linkedin = localStorage.getItem('linkedin');
            const github = localStorage.getItem('github');
            const workExperience = localStorage.getItem('work_experience');
            const education = JSON.parse(localStorage.getItem('education')) || [];
            const skills = JSON.parse(localStorage.getItem('skills')) || [];

            const profilePictureElement = document.getElementById('preview_profile_picture');
            if (profilePictureURL) {
                profilePictureElement.src = profilePictureURL;
                profilePictureElement.style.display = 'block';
            } else {
                profilePictureElement.style.display = 'none';
            }

            document.getElementById('preview_name').textContent = name || 'Your Name';
            document.getElementById('preview_email').textContent = email || 'Your Email';
            document.getElementById('preview_email').href = `mailto:${email || ''}`;
            
            const linkedinElement = document.querySelector('.linkedin');
            if (linkedin) {
                linkedinElement.style.display = 'block';
                document.getElementById('preview_linkedin').textContent = getDisplayName(linkedin);
                document.getElementById('preview_linkedin').href = linkedin;
            } else {
                linkedinElement.style.display = 'none';
            }

            const githubElement = document.querySelector('.github');
            if (github) {
                githubElement.style.display = 'block';
                document.getElementById('preview_github').textContent = getDisplayName(github);
                document.getElementById('preview_github').href = github;
            } else {
                githubElement.style.display = 'none';
            }

            document.getElementById('preview_work_experience').textContent = workExperience || 'Work Experience...';

            const educationList = document.getElementById('preview_education');
            educationList.innerHTML = '';
            education.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                educationList.appendChild(li);
            });

            const skillsList = document.getElementById('preview_skills');
            skillsList.innerHTML = '';
            skills.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                skillsList.appendChild(li);
            });
        }

        document.getElementById('save_changes').addEventListener('click', () => {
            const name = document.getElementById('preview_name').textContent;
            const email = document.getElementById('preview_email').textContent;
            const linkedin = document.getElementById('preview_linkedin').textContent;
            const github = document.getElementById('preview_github').textContent;
            const workExperience = document.getElementById('preview_work_experience').textContent;

            const education = [...document.querySelectorAll('#preview_education li')].map(item => item.textContent);
            const skills = [...document.querySelectorAll('#preview_skills li')].map(item => item.textContent);

            localStorage.setItem('name', name);
            localStorage.setItem('email', email);
            localStorage.setItem('linkedin', linkedin);
            localStorage.setItem('github', github);
            localStorage.setItem('work_experience', workExperience);
            localStorage.setItem('education', JSON.stringify(education))
            localStorage.setItem('skills', JSON.stringify(skills));

            alert('Changes saved!');
        });

        window.onload = populatePreview;
    </script>
</body>
</html>